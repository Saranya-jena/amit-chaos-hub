{
  "kind": "Workflow",
  "apiVersion": "argoproj.io/v1alpha1",
  "metadata": {
    "name": "nginx-pod-delete-1697748071",
    "namespace": "hce",
    "labels": {
      "infra_id": "f68f5c65-ab1a-4a42-a2b9-5043893115c9",
      "revision_id": "481d375b-acec-4da8-80f7-63b766bfcb8d",
      "subject": "custom-chaos-workflow_litmus",
      "workflow_id": "73d122dd-23f3-479a-a8bf-cd7eb454e0f7",
      "workflows.argoproj.io/controller-instanceid": "f68f5c65-ab1a-4a42-a2b9-5043893115c9"
    }
  },
  "spec": {
    "templates": [
      {
        "name": "custom-chaos",
        "inputs": {},
        "outputs": {},
        "metadata": {},
        "steps": [
          [
            {
              "name": "install-chaos-faults",
              "template": "install-chaos-faults",
              "arguments": {}
            }
          ],
          [
            {
              "name": "pod-delete-o2z",
              "template": "pod-delete-o2z",
              "arguments": {}
            }
          ],
          [
            {
              "name": "cleanup-chaos-resources",
              "template": "cleanup-chaos-resources",
              "arguments": {}
            }
          ]
        ]
      },
      {
        "name": "install-chaos-faults",
        "inputs": {
          "artifacts": [
            {
              "name": "pod-delete-o2z",
              "path": "/tmp/pod-delete-o2z.yaml",
              "raw": {
                "data": "apiVersion: litmuschaos.io/v1alpha1\ndescription:\n  message: |\n    Deletes a pod belonging to a deployment/statefulset/daemonset\nkind: ChaosExperiment\nmetadata:\n  name: pod-delete\n  labels:\n    name: pod-delete\n    app.kubernetes.io/part-of: litmus\n    app.kubernetes.io/component: chaosexperiment\n    app.kubernetes.io/version: ci\nspec:\n  definition:\n    scope: Namespaced\n    permissions:\n      - apiGroups:\n          - \"\"\n        resources:\n          - pods\n        verbs:\n          - create\n          - delete\n          - get\n          - list\n          - patch\n          - update\n          - deletecollection\n      - apiGroups:\n          - \"\"\n        resources:\n          - events\n        verbs:\n          - create\n          - get\n          - list\n          - patch\n          - update\n      - apiGroups:\n          - \"\"\n        resources:\n          - configmaps\n        verbs:\n          - get\n          - list\n      - apiGroups:\n          - \"\"\n        resources:\n          - pods/log\n        verbs:\n          - get\n          - list\n          - watch\n      - apiGroups:\n          - \"\"\n        resources:\n          - pods/exec\n        verbs:\n          - get\n          - list\n          - create\n      - apiGroups:\n          - apps\n        resources:\n          - deployments\n          - statefulsets\n          - replicasets\n          - daemonsets\n        verbs:\n          - list\n          - get\n      - apiGroups:\n          - apps.openshift.io\n        resources:\n          - deploymentconfigs\n        verbs:\n          - list\n          - get\n      - apiGroups:\n          - \"\"\n        resources:\n          - replicationcontrollers\n        verbs:\n          - get\n          - list\n      - apiGroups:\n          - argoproj.io\n        resources:\n          - rollouts\n        verbs:\n          - list\n          - get\n      - apiGroups:\n          - batch\n        resources:\n          - jobs\n        verbs:\n          - create\n          - list\n          - get\n          - delete\n          - deletecollection\n      - apiGroups:\n          - litmuschaos.io\n        resources:\n          - chaosengines\n          - chaosexperiments\n          - chaosresults\n        verbs:\n          - create\n          - list\n          - get\n          - patch\n          - update\n          - delete\n    image: chaosnative/go-runner:ci\n    imagePullPolicy: Always\n    args:\n      - -c\n      - ./experiments -name pod-delete\n    command:\n      - /bin/bash\n    env:\n      - name: TOTAL_CHAOS_DURATION\n        value: \"15\"\n      - name: RAMP_TIME\n        value: \"\"\n      - name: FORCE\n        value: \"true\"\n      - name: CHAOS_INTERVAL\n        value: \"5\"\n      - name: PODS_AFFECTED_PERC\n        value: \"\"\n      - name: LIB\n        value: litmus\n      - name: TARGET_PODS\n        value: \"\"\n      - name: NODE_LABEL\n        value: \"\"\n      - name: SEQUENCE\n        value: parallel\n      - name: DEFAULT_HEALTH_CHECK\n        value: 'false'\n    labels:\n      name: pod-delete\n      app.kubernetes.io/part-of: litmus\n      app.kubernetes.io/component: experiment-job\n      app.kubernetes.io/version: ci\n"
              }
            }
          ]
        },
        "outputs": {},
        "metadata": {},
        "container": {
          "name": "",
          "image": "litmuschaos/k8s:2.13.0",
          "command": [
            "sh",
            "-c"
          ],
          "args": [
            "kubectl apply -f /tmp/pod-delete-o2z.yaml -n {{workflow.parameters.adminModeNamespace}} && sleep 30"
          ],
          "resources": {}
        }
      },
      {
        "name": "pod-delete-o2z",
        "inputs": {
          "artifacts": [
            {
              "name": "pod-delete-o2z",
              "path": "/tmp/chaosengine-pod-delete-o2z.yaml",
              "raw": {
                "data": "apiVersion: litmuschaos.io/v1alpha1\nkind: ChaosEngine\nmetadata:\n  namespace: \"{{workflow.parameters.adminModeNamespace}}\"\n  generateName: pod-delete-o2z\n  labels:\n    instance_id: 2760c483-64b6-4b65-a70d-368b72e7549b\n    workflow_name: custom-chaos-workflow-1657185180\nspec:\n  appinfo:\n    appns: default\n    applabel: app=nginx\n    appkind: deployment\n  engineState: active\n  chaosServiceAccount: litmus-admin\n  experiments:\n    - name: pod-delete\n      spec:\n        components:\n          env:\n            - name: TOTAL_CHAOS_DURATION\n              value: \"30\"\n            - name: CHAOS_INTERVAL\n              value: \"10\"\n            - name: FORCE\n              value: \"false\"\n            - name: PODS_AFFECTED_PERC\n              value: \"\"\n        probe:\n          - name: healthcheck\n            type: cmdProbe\n            mode: Edge\n            runProperties:\n              probeTimeout: 180\n              retry: 0\n              interval: 1\n              stopOnFailure: true\n            cmdProbe/inputs:\n              command: ./healthcheck -name pod-level\n              source:\n                image: chaosnative/go-runner:3.0.0-beta3\n                inheritInputs: true\n              comparator:\n                type: string\n                criteria: contains\n                value: \"[P000]\"\n"
              }
            }
          ]
        },
        "outputs": {},
        "metadata": {
          "labels": {
            "weight": "10"
          }
        },
        "container": {
          "name": "",
          "image": "litmuschaos/litmus-checker:2.13.0",
          "args": [
            "-file=/tmp/chaosengine-pod-delete-o2z.yaml",
            "-saveName=/tmp/engine-name"
          ],
          "resources": {}
        }
      },
      {
        "name": "cleanup-chaos-resources",
        "inputs": {},
        "outputs": {},
        "metadata": {},
        "container": {
          "name": "",
          "image": "litmuschaos/k8s:latest",
          "command": [
            "sh",
            "-c"
          ],
          "args": [
            "kubectl delete chaosengine -l 'instance_id in (2760c483-64b6-4b65-a70d-368b72e7549b, )' -n {{workflow.parameters.adminModeNamespace}} "
          ],
          "resources": {}
        }
      }
    ],
    "entrypoint": "custom-chaos",
    "arguments": {
      "parameters": [
        {
          "name": "adminModeNamespace",
          "value": "litmus"
        }
      ]
    },
    "serviceAccountName": "argo-chaos",
    "podGC": {
      "strategy": "OnWorkflowCompletion"
    },
    "securityContext": {
      "runAsUser": 1000,
      "runAsNonRoot": true
    }
  },
  "status": {}
}
